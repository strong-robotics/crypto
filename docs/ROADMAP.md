# Roadmap по обновлению Status Bar

Документ фиксирует текущий план работ по подключению реальных данных к статус-бару, а также необходимые изменения на фронтенде и бэкенде.

## 1. Источники данных и метрики
- **Баланс и кошельки**: получать из `/ws/balances`. Суммировать `value_usd`, считать количество кошельков, отображать статус мониторинга.
- **Текущие токены**: получать из `/ws/tokens`. Использовать поля `check_jupiter`, `history_ready`, `token_pair`, `walletId` (при наличии) для расчёта метрик «In Trade», «New», «Scanned».
- **Статусы процессов**:
  - Auto-scan новых токенов — `state.scanner.get_status()` (`server/_v3_new_tokens.py`).
  - Analyzer Jupiter — запланированные методы `start/stop/status` в `JupiterAnalyzerV3`.
  - History/Trades scanner — функции из `TradesHistory` и сервисного слоя (см. `server/temp/main_old.py`).
- **Дополнительные агрегаты**: при необходимости добавить SQL-хелперы к таблицам `tokens` и `trades` (структура описана в `server/v2/migrate_to_crypto_db_v3.py`).

## 2. Доработки бэкенда
- Перенести эндпоинты History Scanner (`/api/history-scanner/start|stop|status`) из `server/temp/main_old.py` в актуальный `server/main.py`, восстановить фоновые задачи.
- Добавить публичные методы `start_auto_scan/stop_auto_scan/get_status` для `JupiterAnalyzerV3`, если их нет в использовании, и обернуть в REST-эндпоинты.
- Расширить `BalanceV1` статусным эндпоинтом (`/api/balance/status`) для передачи `is_monitoring`, количества кошельков и подключённых клиентов.
- Создать агрегирующие эндпоинты (или вебсокет) для метрик: общее число токенов, новые токены, завершённые сканирования, активные сделки.
- Рассмотреть отдельный `/ws/status` для периодической трансляции статусов, чтобы уменьшить количество HTTP-запросов.

## 3. Изменения на фронтенде
- Расширить `StatusBarProps` (см. `src/components/status-bar.tsx`) новыми полями:
  - числовые показатели: `totalBalance`, `walletsCount`, `inTradeCount`, `newTokensCount`, `scannedTokensCount`;
  - статусы модулей: `scannerStatus`, `analyzerStatus`, `historyStatus`, `tradesStatus`;
  - обязательные коллбеки `onNewTokensStart/Stop`, `onAnalyzerStart/Stop`, `onTradesStart/Stop`, `onHistoryStart/Stop`.
- Удалить жёстко прошитые значения из статус-бара и заменить на реальные данные, получаемые из состояния.
- Доработать `src/app/page.tsx`:
  - В `useEffect` и обработчиках сохранить новые состояния, подписаться на обновлённые эндпоинты/вебсокеты.
  - Реализовать отдельные функции запуска/остановки для каждого процесса, передавать их в `StatusBar`.
  - Отображать `serverStatus` и статусы подключений в UI.
- Настроить визуальное отображение статусов (цвета, подписи) на основе реальных флагов, добавить состояния загрузки или блокировки кнопок во время запросов.

## 4. Проверка и валидация
- Протестировать сценарии запуска/остановки всех процессов и убедиться, что значения в статус-баре обновляются в реальном времени.
- Проверить корректность подсчёта метрик на примерах из БД (активные токены, истории, количество сделок).
- При необходимости подготовить автоматические smoke-тесты или скрипты для локальной проверки эндпоинтов.

## 5. Следующие шаги
1. Реализовать недостающие бэкенд-эндпоинты и статусы.
2. Обновить фронтенд-компоненты, подключив реальные данные.
3. Выполнить комплексное тестирование и уточнить формат отображаемых метрик с продуктовой командой.
